{% extends "LouvreTicketPlatformBundle::layout.html.twig" %}

{% block title %}
    {{ parent() }}
{% endblock %}

{% block louvreticket_body %}

    <h2> Etape 3</h2>

    <div class="well">
        Votre email: {{ recap1.email }}
        <br/>
        Date de votre visite: {{ recap1.visitDate|date('d-m-Y') }}
        <br/>
        Nombre de billets réservés: {{ recap1.numberOfTickets }}
        <br/>
        Type de billet réservé: {{ recap1.ticketType }}
    </div>
    <div>
        <h3>Veuillez controler l'exactitude des informations avant de valider</h3><br/>
        <div class="row well">
            {% for form in recap2.form2 %}
                <div class="col-md-10">
                    <p>Nom: {{ form.name }}</p>
                    <p>Prénom: {{ form.firstName }}</p>
                    <p>Date de naissance: {{ form.birthDate|date('d-m-Y') }}</p>
                    <p>Tarif réduit: {{ form.reducedPrice ? 'Oui Un justificatif vous sera demandé lors de votre
                entrée au musée ':'Non' }}</p>
                    <br/>
                </div>
                <div class="col-md-2">
                    {{ form.realPrice }}€
                </div>
            {% endfor %}
        </div>
        <div class="row well">
            <div class="col-md-offset-10 col-md-2">
                Total = {{ recap2.totalPrice }}€
            </div>
        </div>

        {% if errorMessage is defined %}
        <div class="alert alert-danger">
            {{ errorMessage }}
        </div>
        {% endif %}


        <div class="row">
            <div class="col-md-offset-2 col-md-6 bg-primary"><br/>
                <form id="payment_form"  method="post">
                    <div class="form-group">
                        <label for="name">Votre nom</label>
                        <input type="text" name = "cardName" placeholder="Votre nom" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="cardNumber">Votre numéro de carte bancaire</label>
                        <input type="text" placeholder="4242 4242 4242 4242" class="form-control" data-stripe="number">
                    </div>
                    <div class="form-group">
                        <label for="expMonth">Mois d'expiration</label>
                        <input type="text" placeholder="MM" class="form-control" data-stripe="exp_month">
                    </div>
                    <div class="form-group">
                        <label for="expYear">Année d'expiration</label>
                        <input type="text" placeholder="AA" class="form-control" data-stripe="exp_year">
                    </div>
                    <div class="form-group">
                        <label for="securityCode">Code de sécurité</label>
                        <input type="text" placeholder="Code de sécurité" class="form-control" data-stripe="cvc">
                    </div><br/>
                    <div class="form-group">
                        <button type="submit" class="btn btn-default">Payer</button>
                    </div>
                    <br/>
                </form>
            </div>
        </div>


    </div>



        <script type="text/javascript" src="https://js.stripe.com/v2/"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

        <script>

            Stripe.setPublishableKey('pk_test_WjHJkRf8mEI5hYufVKkqlbWw');
            var $form = $('#payment_form');
            $form.submit(function(e){
                e.preventDefault();
                $form.find('button').attr('disabled', true);
                Stripe.card.createToken($form, function(status, response){
                    if (response.error){
                        $form.find('.message').remove();
                        $form.prepend('<div>'+ response.error.message + '</div>')
                    } else {
                        var token = response.id;
                        $form.append($('<input type="hidden" name="stripeToken">').val(token));
                        $form.get(0).submit();
                        return token;
                    }
                })
            })

        </script>


{% endblock %}